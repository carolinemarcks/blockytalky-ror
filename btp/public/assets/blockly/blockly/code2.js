/**
 * Blockly Apps: Code
 *
 * Copyright 2012 Google Inc.
 * http://blockly.googlecode.com/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getScript(e,t){var o=document.createElement("script");o.src=e;var l=document.getElementsByTagName("head")[0],c=!1;o.onload=o.onreadystatechange=function(){c||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(c=!0,t(),o.onload=o.onreadystatechange=null,l.removeChild(o))},l.appendChild(o)}function tabClick(e){if("tabon"==document.getElementById("tab_xml").className){var t=document.getElementById("textarea_xml"),o=t.value,l=null;try{l=Blockly.Xml.textToDom(o)}catch(c){var n=window.confirm(BlocklyApps.getMsg("badXml").replace("%1",c));if(!n)return}l&&(Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,l))}for(var a in TABS_)document.getElementById("tab_"+TABS_[a]).className="taboff",document.getElementById("content_"+TABS_[a]).style.display="none";selected=e.replace("tab_",""),document.getElementById(e).className="tabon";var r=document.getElementById("content_"+selected);r.style.display="block",renderContent()}function renderContent(){var e=document.getElementById("content_"+selected);if("content_blocks"==e.id)Blockly.mainWorkspace.render();else if("content_xml"==e.id){var t=document.getElementById("textarea_xml"),o=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),l=Blockly.Xml.domToPrettyText(o);t.value=l,t.focus()}else"content_javascript"==e.id?e.innerHTML=Blockly.Generator.workspaceToCode("JavaScript"):"content_python"==e.id&&(e.innerHTML=Blockly.Generator.workspaceToCode("Python"))}function init(e){window.Blockly=e,BlocklyApps.init(),Blockly.JavaScript.addReservedWords("code,timeouts,checkTimeout"),window.setTimeout(function(){Blockly.Toolbox.width&&(document.getElementById("tab_blocks").style.minWidth=Blockly.Toolbox.width-38+"px")},1),BlocklyApps.loadBlocks(""),"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload(),tabClick("tab_"+selected)}function runJS(){Blockly.JavaScript.INFINITE_LOOP_TRAP="  checkTimeout();\n";var timeouts=0,checkTimeout=function(){if(timeouts++>1e6)throw BlocklyApps.getMsg("timeout")},code=Blockly.Generator.workspaceToCode("JavaScript");Blockly.JavaScript.INFINITE_LOOP_TRAP=null;try{eval(code)}catch(e){alert(BlocklyApps.getMsg("badCode").replace("%1",e))}}function discard(){var e=Blockly.mainWorkspace.getAllBlocks().length;(2>e||window.confirm(BlocklyApps.getMsg("discard").replace("%1",e)))&&(Blockly.mainWorkspace.clear(),window.location.hash="")}function uploadToRobot(){var e=getXML(),t=getIP()+"upload";$.ajax({type:"POST",url:t,data:e,success:function(e){console.log(e)},error:function(e){console.log(e)}})}function runRobot(){var e="a",t=getIP()+"run";$.ajax({type:"POST",url:t,data:e,success:function(e){console.log(e)},error:function(e){console.log(e)}})}function getIP(){var e=document.URL,t=e.substring(0,e.length-7);return console.log(t),t}function getXML(){var e=document.getElementById("textarea_xml"),t=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),o=Blockly.Xml.domToPrettyText(t);if(e.value=o,">"==o[4]){o=o.substring(5);var l='<xml xmlns="http://www.w3.org/1999/xhtml">';o=l+o}var c=removeWhite(o);return c}function stopRobot(){var e=getIP()+"stop",t="a";$.ajax({type:"POST",url:e,data:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})}function removeWhite(e){for(var t="",o=!1,l=0;l<e.length;l++)"\n"==e.charAt(l)?o=!0:1==o&&"<"==e.charAt(l)?(o=!1,t+=e[l]):0==o&&(t+=e[l]);return t}function loadCode(){$.get("/load",function(e){$("#tab_xml").click(),$("#textarea_xml").val(e),$("#tab_blocks").click()})}function toPython(e){id="tab_xml";for(var t in TABS_)document.getElementById("tab_"+TABS_[t]).className="taboff",document.getElementById("content_"+TABS_[t]).style.display="none";selected=id.replace("tab_",""),document.getElementById(id).className="tabon";var o=document.getElementById("content_"+selected);o.style.display="block";{var l=document.getElementById("textarea_xml");Blockly.Xml.workspaceToDom(Blockly.mainWorkspace)}return l.value=e,tabClick("tab_python"),pythonCode=Blockly.Generator.workspaceToCode("Python")}BlocklyApps.LANGUAGES={en:["English","ltr","en_compressed.js"],de:["Deutsch","ltr","de_compressed.js"],hu:["Magyar","ltr","en_compressed.js"],vi:["Tiếng Việt","ltr","vi_compressed.js"],"zh-tw":["中國的","ltr","zh_tw_compressed.js"]},BlocklyApps.LANG=BlocklyApps.getLang(),document.write('<script type="text/javascript" src="generated/en2.js"></script>\n'),getScript("http://code.jquery.com/jquery-latest.min.js",function(){});var TABS_=["blocks",,"python","xml"],selected="blocks";