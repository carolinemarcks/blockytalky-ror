/**
 * Blockly Apps: Common code
 *
 * Copyright 2013 Google Inc.
 * http://blockly.googlecode.com/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";var BlocklyApps={};BlocklyApps.getStringParamFromUrl=function(o,l){var e=window.location.search.match(new RegExp("[?&]"+o+"=([^&]+)"));return e?decodeURIComponent(e[1]):l},BlocklyApps.getNumberParamFromUrl=function(o,l,e){var n=Number(BlocklyApps.getStringParamFromUrl(o,"NaN"));return isNaN(n)?l:Math.min(Math.max(l,n),e)},BlocklyApps.getLang=function(){var o=BlocklyApps.getStringParamFromUrl("lang","");if(BlocklyApps.LANGUAGES[o])return document.cookie="lang="+escape(o)+"; path=/",o;var l=document.cookie.match(/(^|;)\s*lang=(\w+)/);if(l&&(o=unescape(l[2]),BlocklyApps.LANGUAGES[o]))return o;if(o=navigator.language,BlocklyApps.LANGUAGES[o])return o;if(o="en",BlocklyApps.LANGUAGES[o])return o;for(var o in BlocklyApps.LANGUAGES)return o;throw"No languages available."},BlocklyApps.LANG=void 0,BlocklyApps.LANGUAGES=void 0,BlocklyApps.init=function(){"rtl"==BlocklyApps.LANGUAGES[BlocklyApps.LANG][1];document.head.parentElement.setAttribute("dir",BlocklyApps.LANGUAGES[BlocklyApps.LANG][1]),document.head.parentElement.setAttribute("lang",BlocklyApps.LANG);var o=[];for(var l in BlocklyApps.LANGUAGES)o.push(BlocklyApps.LANGUAGES[l].concat(l));var e=function(o,l){return o[0]>l[0]?1:o[0]<l[0]?-1:0};o.sort(e);var n=document.getElementById("linkButton");!n||"BlocklyStorage"in window||(n.className="disabled");var t=document.querySelector('meta[name="viewport"]');t&&screen.availWidth<725&&t.setAttribute("content","width=725, initial-scale=.35, user-scalable=no")},BlocklyApps.loadBlocks=function(o){if("BlocklyStorage"in window&&window.location.hash.length>1)BlocklyStorage.retrieveXml(window.location.hash.substring(1));else if(window.sessionStorage.loadOnceBlocks){var l=window.sessionStorage.loadOnceBlocks;delete window.sessionStorage.loadOnceBlocks;var e=Blockly.Xml.textToDom(l);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e)}else if(o){var e=Blockly.Xml.textToDom(o);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e)}else"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)},BlocklyApps.changeLanguage=function(){var o=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),l=Blockly.Xml.domToText(o);window.sessionStorage.loadOnceBlocks=l;var e=document.getElementById("languageMenu"),n=encodeURIComponent(e.options[e.selectedIndex].value),t=window.location.search;t=t.length<=1?"?lang="+n:t.match(/[?&]lang=[^&]*/)?t.replace(/([?&]lang=)[^&]*/,"$1"+n):t.replace(/\?/,"?lang="+n+"&"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+t},BlocklyApps.updateCapacity=function(){var o=Blockly.mainWorkspace.remainingCapacity(),l=document.getElementById("capacity");1/0==o?l.style.display="none":(l.style.display="inline",0==o?l.innerHTML=BlocklyApps.getMsg("capacity0"):1==o?l.innerHTML=BlocklyApps.getMsg("capacity1"):(o=Number(o),l.innerHTML=BlocklyApps.getMsg("capacity2").replace("%1",o)))},BlocklyApps.highlight=function(o){if(o){var l=o.match(/^block_id_(\d+)$/);l&&(o=l[1])}Blockly.mainWorkspace.highlightBlock(o)},BlocklyApps.checkTimeout=function(o){if(o&&BlocklyApps.log.push([null,o]),BlocklyApps.ticks--<0)throw 1/0},BlocklyApps.stripCode=function(o){o=o.replace(/(,\s*)?'block_id_\d+'\)/g,")");var l=new RegExp(Blockly.JavaScript.INFINITE_LOOP_TRAP.replace("(%1)","\\(\\)"),"g");return o.replace(l,"")},BlocklyApps.showCode=function(){var o=Blockly.Generator.workspaceToCode("JavaScript");o=BlocklyApps.stripCode(o),window.alert(o)},BlocklyApps.getMsg=function(o){var l=BlocklyApps.getMsgOrNull(o);return null===l?"[Unknown message: "+o+"]":l},BlocklyApps.getMsgOrNull=function(o){var l=document.getElementById(o);if(l){var e=l.innerHTML;return e=e.replace(/\\n/g,"\n")}return null},BlocklyApps.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var o,l=document.getElementsByTagName("button"),e=0;o=l[e];e++)o.ontouchend||(o.ontouchend=o.onclick)},window.addEventListener("load",BlocklyApps.addTouchEvents,!1);