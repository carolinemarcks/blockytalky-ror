
<link rel="stylesheet" type="text/css" href="/static/style.css">
  <script type="text/javascript" src="/static/_soy/soyutils.js"></script>
  <script type="text/javascript" src="/static/common.js"></script>
  <script type="text/javascript" src="/static/code.js"></script>
  <script type="text/javascript" src="/static/storage.js"></script>

<script type="text/javascript">
    var hasInit = false; 

 
  function doBlocklyInitialize(){
        if(hasInit){return;}
        hasInit = true;
    
        $('#blocklyDiv').html(codepage.start({},null,
            {langSrc: BlocklyApps.LANGUAGES[BlocklyApps.LANG][2]}));
        initializeSensors();
        }
    function printblockly2(){
        var el = document.getElementById("content_blocks");
        el.contentWindow.printblockly()
    }

    function initializeSensors() {
        function setSensor(sensorName, option) {
            //If the option exists
            if($("#" + sensorName + " option[value='" + option + "']").length > 0) {
                $("#" + sensorName).val(option);
            }
        }
        setSensor("sensor1", "<%= @code.sensor1 %>");
        setSensor("sensor2", "<%= @code.sensor2 %>");
        setSensor("sensor3", "<%= @code.sensor3 %>");
        setSensor("sensor4", "<%= @code.sensor4 %>");
    }

    function renderBlocksOuter(){
       <% if(@code.codetext) %>
            var code =  <%= ("'" + @code.codetext + "'").html_safe %> ;
            var el = document.getElementById("content_blocks");
            el.contentWindow.renderBlocksInner(code);
        <% end %>

    }
        
    $(document).ready(doBlocklyInitialize);
</script>

